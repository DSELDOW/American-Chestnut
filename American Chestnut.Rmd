---
title: "American Chestnut"
author: "Gabriel M. David S."
date: "9/23/2019"
output:
  pdf_document: default
  html_document: default
header-includes:
  - \usepackage{xcolor}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 1

We chose the American Chestnut becuase of \textcolor{red}{its}it's unique conservation issues due to the presence of Cryphonectria parasitica, the causative agent leading to chestnut blight. The near extinction of the Chestnut caused by the blight was one of the most remarkable epidemics due to its rapid elimination of nearly 4 billion mature trees. An interesting piece of the Chestnut's story is the presence of a hypovirus that acts as a htyperparasite to C. parasitica. The hypovirus is credited with preventing the spread of the lbight in Europe, especially in mature trees. North American species have not seen the same restorative qualities due to the hyperparasite. 

## Question 2

We want to look into the stage that is being affected most by the blight and determine which life stage of the tree is most crucial for increasing population size. The data from these matrices included epidemic, recovering, and unaffected populations but we chose to examine the epidemic populations. 

## Question 3

```{r}
load("COMPADRE_v.5.0.0.RData")
matrix<-compadre$mat[6536][[1]]$matA
eigout<-eigen(matrix)
lambda <- Re(eigout$values[1])
w <- Re(eigout$vectors[,1])
```

```{r}
leigout <- eigen(t(matrix))
leigout$values[1]
v <- Re(leigout$vectors[,1])

```

```{r}
sensitivity <- function(v, w){
  mat = matrix(0, 8, 8)
  for (i in 1:8){
    for (j in 1:8){
      mat[i,j] = v[i]*w[j]/(v %*% w)
    }
  }
  return(mat)
}

elasticity <- function(A, lambda, v, w){
  mat = matrix(0, 8, 8)
  for (i in 1:8){
    for (j in 1:8){
      mat[i,j] = (A[i,j]/lambda)*(v[i]*w[j]/(v %*% w))
    }
  }
  return(mat)
}
```

```{r}
sensitivities <- sensitivity(v, w)
elasticities <- elasticity(matrix, lambda, v, w)
```


The eigen value tells us that the population is delcining, though being so close to 1 it is not dropping precipitously. This was a surprising quality for the epidemic population but we knew that the blight does not affect the roots of the tree and thus the population is able to present near sustainable qualities.

"w", the right eigenvector, represents the stable population distribution across stages. It is easier to interpret if we normalize to sum to one instead of having a magnitude of one.

```{r, eval=TRUE, echo=TRUE}
w/sum(w)
```

We can see that the vast majority of the population is concentrated in stages 5 and 6, the juvenile stage and smallest potentially reproductive stage. Given that almost half of the stable population distribution is in a potentially reproductive stage, this could explain how the American chestnut demonstrates a fairly slow rate of decline despite the blight.


## Question 4

```{r}
stages = c(1:8)
Ps = c()
Fs = c()
for (i in stages){
  Ps = c(Ps, elasticities[i,i])
  Fs = c(Fs, elasticities[1,i])
}
plot(stages, Ps,type='b', pch=1)
par(new=T)
plot(stages, Fs,type='b', pch=4, axes=F)
axis(side=4)
mtext(side=4, line=3, "Fs")
```

```{r}
stages2 = c(1:7)
Gs = c()
for (i in stages2){
  if (i == 2){
    Gs = c(Gs, elasticities[i+2, i])
  } else {
  Gs = c(Gs, elasticities[i+1,i])
  }
}
plot(stages2, Gs,type='b', pch=1)
```
```{r}
Rs = matrix(0, 5, 5)
for (j in 4:8){
  for (i in 3:(j-1)){
    Rs[j-3, i-2] = elasticities[i, j]
  }
}
plot(3:7, Rs[1,], type='b', ylim=c(0, .035), pch=1)
pchars = c(0, 2, 3, 4, 5)
for (row in 2:5){
  points(3:7, Rs[row,], type='b', pch=pchars[row])
}
```

```{r}
mat_dff <- matrix
mat_dff[1, 6] <- .001
mat_dff[1, 7] <- .03
mat_dff[1, 8] <- 7.74

mat_rf <- matrix
mat_rf[1, 6] <- .016
mat_rf[1, 7] <- .78
mat_rf[1, 8] <- 2.43

eigout_dff <- eigen(mat_dff)
eigout_rf <- eigen(mat_rf)

Re(eigout_dff$values[1])
w_dff <- Re(eigout_dff$vectors[,1])
w_dff/sum(w_dff)
Re(eigout_rf$values[1])
w_rf <- Re(eigout_rf$vectors[,1])
w_rf/sum(w_rf)
```




## Easton comments

- Nice job on this assignment overall. You do a nice job at moving between the math and the biological interpretations
- Be sure to use "relative paths" when pulling in data files if you are working with collaborators. In the first code chunk, you write ``load("C:/Users/gmeye/Documents/SoftwareCarpentry/r_lessons/COMPADRE_v.5.0.0.RData")``. I don't have the same file structure as you, so this code wouldn't work on my computer 
- I like how you built your own custom sensitivity and elasticity functions, nice work
- I appreciated the plots you produced. They make it easier to compare elasticities. It may have been helpful to include a figure legend or caption as well.
- Can you go back and add additional text explaining your results for question 4? I want to know how you answered your problem proposed in question 2.