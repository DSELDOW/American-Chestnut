---
title: "American Chestnut"
author: "Gabriel M. David S."
date: "9/23/2019"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Question 1

We chose the American Chestnut becuase of it's unique conservation issues due to the presence of Cryphonectria parasitica, the causative agent leading to chestnut blight. The near extinction of the Chestnut caused by the blight was one of the most remarkable epidemics due to its rapid elimination of nearly 4 billion mature trees. An interesting piece of the Chestnut's story is the presence of a hypovirus that acts as a htyperparasite to C. parasitica. The hypovirus is credited with preventing the spread of the lbight in Europe, especially in mature trees. North American species have not seen the same restorative qualities due to the hyperparasite. 

## Question 2

We want to look into the stage that is being affected most by the blight and determine which life stage of the tree is most crucial for increasing population size. The data from these matrices included epidemic, recovering, and unaffected populations but we chose to examine the epidemic populations. 

## Question 3

```{r}
load("C:/Users/gmeye/Documents/SoftwareCarpentry/r_lessons/COMPADRE_v.5.0.0.RData")
A <-compadre$mat[6536][[1]]$matA
eigout<-eigen(A)
lambda <- Re(eigout$values[1])
w <- Re(eigout$vectors[,1])
```

```{r}
leigout <- eigen(t(A))
leigout$values[1]
v <- Re(leigout$vectors[,1])

```

```{r}
sensitivity <- function(v, w){
  mat = matrix(0, 8, 8)
  for (i in 1:8){
    for (j in 1:8){
      mat[i,j] = v[i]*w[j]/(v %*% w)
    }
  }
  return(mat)
}

elasticity <- function(A, lambda, v, w){
  mat = matrix(0, 8, 8)
  for (i in 1:8){
    for (j in 1:8){
      mat[i,j] = (A[i,j]/lambda)*(v[i]*w[j]/(v %*% w))
    }
  }
  return(mat)
}
```

```{r}
sensitivities <- sensitivity(v, w)
elasticities <- elasticity(A, lambda, v, w)
```


The eigen value tells us that the population is delcining, though being so close to 1 it is not dropping precipitously. This was a surprising quality for the epidemic population but we knew that the blight does not affect the roots of the tree and thus the population is able to present near sustainable qualities.

"w", the right eigenvector, represents the stable population distribution across stages. It is easier to interpret if we normalize to sum to one instead of having a magnitude of one.

```{r, eval=TRUE, echo=TRUE}
w/sum(w)
```

We can see that the vast majority of the population is concentrated in stages 5 and 6, the juvenile stage and smallest potentially reproductive stage. Given that almost half of the stable population distribution is in a potentially reproductive stage, this could explain how the American chestnut demonstrates a fairly slow rate of decline despite the blight.


## Question 4

```{r}
stages = c(1:8)
Ps = c()
Fs = c()
for (i in stages){
  Ps = c(Ps, elasticities[i,i])
  Fs = c(Fs, elasticities[1,i])
}
plot(stages, Ps,type='b', pch=1)
par(new=T)
plot(stages, Fs,type='b', pch=4, axes=F)
axis(side=4)
mtext(side=4, line=3, "Fs")
```

```{r}
stages2 = c(1:7)
Gs = c()
for (i in stages2){
  if (i == 2){
    Gs = c(Gs, elasticities[i+2, i])
  } else {
  Gs = c(Gs, elasticities[i+1,i])
  }
}
Rs = c()
for (j in 4:8){
  Rs = c(Rs, sum(elasticities[3:(j-1),j]))
}
plot(stages2, Gs,type='b', pch=1)
points(4:8, Rs, type='b', pch=4)
```

## Testing primary effects of the disease

Try replacing diseased fecundity values with disease free or recovering values.

```{r}
mat_dff <- A
mat_dff[1, 6] <- .001
mat_dff[1, 7] <- .03
mat_dff[1, 8] <- 7.74

mat_rf <- A
mat_rf[1, 6] <- .016
mat_rf[1, 7] <- .78
mat_rf[1, 8] <- 2.43

eigout_dff <- eigen(mat_dff)
eigout_rf <- eigen(mat_rf)

Re(eigout_dff$values[1])
w_dff <- Re(eigout_dff$vectors[,1])
w_dff/sum(w_dff)
Re(eigout_rf$values[1])
w_rf <- Re(eigout_rf$vectors[,1])
w_rf/sum(w_rf)
```

Try replacing diseased retrogression (and P) values with disease free and recovering values.

```{r}
mat_dfr <- A
mat_dfr[-1:-3, 7] = c(0., 0., 0., 0.9415, 0.0585)
mat_dfr[-1:-3, 8] = c(0., 0.0075, 0., 0., 0.98675)

mat_rr <- A
mat_rr[-1:-3, 7] = c(0.002, 0.005, 0.04, 0.91, 0.04)
mat_rr[-1:-3, 8] = c(0., 0., 0.005, 0.05, .944)

eigout_dfr <- eigen(mat_dfr)
eigout_rr <- eigen(mat_rr)

Re(eigout_dfr$values[1])
w_dfr <- Re(eigout_dfr$vectors[,1])
w_dfr/sum(w_dfr)
Re(eigout_rr$values[1])
w_rr <- Re(eigout_rr$vectors[,1])
w_rr/sum(w_rr)
```
Big effect here, might be worth trying stages 7 and 8 separately.
Maybe we should show the stable pop distribution as pie charts?
